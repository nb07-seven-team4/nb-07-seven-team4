generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}
model Group {
  id                BigInt         @id @default(autoincrement())
  name              String         @unique
  description       String
  photoUrl          String         @map("photo_url")
  tags              String[]
  goalRep           Int            @map("goal_rep")
  discordWebhookUrl String         @map("discord_webhook_url")
  discordInviteUrl  String         @map("discord_invite_url")
  likeCount         Int            @default(0) @map("like_count")
  ownerId           BigInt         @map("owner_id")
  createdAt         DateTime       @default(now()) @map("created_at")
  updatedAt         DateTime       @updatedAt @map("updated_at")

  participants      Participant[]
  records           Record[]
  badges            Badge[]

  @@map("groups")
}

model Participant {
  id        BigInt   @id @default(autoincrement())
  nickname  String
  password  String
  isOwner   Boolean  @default(false) @map("is_owner")
  groupId   BigInt   @map("group_id")
  joinedAt  DateTime @default(now()) @map("joined_at")

  group     Group    @relation(fields: [groupId], references: [id], onDelete: Cascade)
  records   Record[]

  @@unique([groupId, nickname])
  @@map("participants")
}

model Record {
  id            BigInt   @id @default(autoincrement())
  type          String
  description   String?
  time          Int
  distance      Float?
  images        String[]
  createdAt     DateTime @default(now()) @map("created_at")

  groupId       BigInt   @map("group_id")
  participantId BigInt   @map("participant_id")

  group         Group        @relation(fields: [groupId], references: [id], onDelete: Cascade)
  participant   Participant  @relation(fields: [participantId], references: [id], onDelete: Cascade)

  @@map("records")
}

model Badge {
  id        BigInt   @id @default(autoincrement())
  type      String
  groupId   BigInt   @map("group_id")
  earnedAt  DateTime @default(now()) @map("earned_at")

  group     Group    @relation(fields: [groupId], references: [id], onDelete: Cascade)

  @@unique([groupId, type])
  @@map("badges")
}