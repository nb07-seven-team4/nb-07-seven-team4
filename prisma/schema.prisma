generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}
model Group {
  id                BigInt         @id @default(autoincrement())
  name              String         @unique
  description       String
  nickname          String
  password          String
  image             String?
  tags              String[]
  targetCount       Int            @map("target_count")
  discordWebhookUrl String?        @map("discord_webhook_url")
  discordInviteUrl  String?        @map("discord_invite_url")
  recommendations   Int            @default(0)
  createdAt         DateTime       @default(now()) @map("created_at")
  updatedAt         DateTime       @updatedAt @map("updated_at")

  participants      Participant[]
  records           Record[]
  badges            Badge[]

  @@map("groups")
}

model Participant {
  id        BigInt   @id @default(autoincrement())
  nickname  String
  password  String
  groupId   BigInt   @map("group_id")
  joinedAt  DateTime @default(now()) @map("joined_at")

  group     Group    @relation(fields: [groupId], references: [id], onDelete: Cascade)
  records   Record[]

  @@unique([groupId, nickname])
  @@map("participants")
}

model Record {
  id            BigInt   @id @default(autoincrement())
  exerciseType  String   @map("exercise_type")
  description   String?
  duration      Int
  distance      Float?
  images        String[]
  createdAt     DateTime @default(now()) @map("created_at")

  groupId       BigInt   @map("group_id")
  participantId BigInt   @map("participant_id")

  group         Group        @relation(fields: [groupId], references: [id], onDelete: Cascade)
  participant   Participant  @relation(fields: [participantId], references: [id], onDelete: Cascade)

  @@map("records")
}

model Badge {
  id        BigInt   @id @default(autoincrement())
  type      String
  groupId   BigInt   @map("group_id")
  earnedAt  DateTime @default(now()) @map("earned_at")

  group     Group    @relation(fields: [groupId], references: [id], onDelete: Cascade)

  @@unique([groupId, type])
  @@map("badges")
}
